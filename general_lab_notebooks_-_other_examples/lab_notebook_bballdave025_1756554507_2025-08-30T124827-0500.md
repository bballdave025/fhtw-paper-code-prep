# Lab Notebook — bballdave025

## Session Summary

### Focus
- Scaffolding automation scripts for creating project directory structure and placeholder files.  
- Ensuring cross-platform support (Windows CMD, PowerShell, Bash).  
- Transition plan: Local prototyping first (30-min scope), then AWS deployment for full scope.

### Key Progress
1. **Windows CMD / BAT (Option 2 implemented)**
   - Created `py_touch.py` outside loops to avoid script duplication.
   - BAT script iterates over tags to generate directories and placeholder files.
   - Debugging simplified vs. ~2017 BAT practices.

2. **PowerShell & Bash equivalents**
   - Drafted for easier maintainability and modern workflow assumptions (since PowerShell/bash are standard).  
   - Preserves file extensions while appending tags (e.g., `README_p_02_02.md → README.md`).

3. **Test Runs**
   - Scripts not yet verified with sample tags.  
   - `tree` output will be used to confirm correct directory structure and file naming.

### Reflections
- CMD-only support is less relevant in 2025, since PowerShell/bash are widely available.  
- Decision: prefer PowerShell/bash for future development; CMD fallback only if explicitly needed.  
- Plan to discuss complete scope of the project plan to help direct goals.
- The idea is that this will help to avoid spending too much time on a specific part
- Help ensure productivity in line with ADHD/OCD therapy goals.
- ADHD/OCD productivity strategy: *Done-over-perfect*, timed 20–30 minute pushes, then iterate on AWS.
- MOST IMPORTANT for today (Saturday) is *Done-over-perfect* sprint mode.

### Next Steps
- **Today**: 30-minute local push (finish scaffolding, push to GitHub).  
- **Sunday (before 09:00 + 13:00–18:00)**: AWS push (ready ResNet-50++ experiments).  
- **Mon/Tue**: Draft technical vision outline for computer vision paper.  
- **After Tue**: Focus shifts to Chain-of-Thought ideas + interview portfolio prep.

---

## Important scripts

### structure script (PowerShell or bash)

#### Powershell, file `structure.ps1`

What we want to try in the 30-minute session.

```
(PowerShell script, 
   `structure.ps1` 
 given upon request
)
```

```powershell
param(
    [string]$RootDir = "$PWD\new_experiment_dir",
    [string[]]$Tags = @("default")
)

# Ensure root directory exists
if (-not (Test-Path $RootDir)) { New-Item -ItemType Directory -Path $RootDir | Out-Null }

# Create a helper script for touching files
$TouchScript = Join-Path $RootDir "scripts\ps_touch.ps1"
if (-not (Test-Path $TouchScript)) {
    New-Item -ItemType Directory -Path (Split-Path $TouchScript) -Force | Out-Null
    @"
param([string[]]\$Paths)
foreach (\$p in \$Paths) {
    \$file = Resolve-Path -Path \$p -ErrorAction SilentlyContinue
    \$dir = Split-Path \$p
    if (-not (Test-Path \$dir)) { New-Item -ItemType Directory -Path \$dir | Out-Null }
    if (-not (Test-Path \$p)) { New-Item -ItemType File -Path \$p | Out-Null }
}
"@ | Set-Content -LiteralPath $TouchScript
}

# Files to create
$Files = @(
    "README.md",
    "notebooks\00_data_exploration.ipynb",
    "notebooks\01_model_build.ipynb",
    "notebooks\02_training.ipynb",
    "notebooks\03_inference_quick_explore.ipynb",
    "scripts\py_build_model.py",
    "scripts\build_model.ps1",
    "scripts\py_train_model.py",
    "scripts\train_model.ps1",
    "scripts\py_inference.py",
    "scripts\inference.ps1",
    "scripts\py_utils.py"
)

foreach ($tag in $Tags) {
    $TagDir = Join-Path $RootDir $tag

    # Create main directories
    $Dirs = @("notebooks", "datasets", "models", "logs", "scripts", "visualizations", "outputs\csv_logs", "outputs\gradcam_images")
    foreach ($d in $Dirs) { New-Item -ItemType Directory -Path (Join-Path $TagDir $d) -Force | Out-Null }

    # Create files with tag appended to stem
    foreach ($f in $Files) {
        $base = [System.IO.Path]::GetFileNameWithoutExtension($f)
        $ext  = [System.IO.Path]::GetExtension($f)
        $tagged = Join-Path $TagDir "$base`_$tag$ext"
        & powershell -File $TouchScript -Paths $tagged
    }
}

Write-Host "Project scaffolding with tags and subdirectories created at $RootDir"

```

#### Bash, file `structure.sh`

What will most-likely be used on AWS, though possibly without the `datasets` dir.

```
(bash script, 
   `structure.sh` 
 given upon request
)
```

```bash
#!/usr/bin/env bash

ROOT_DIR="${1:-$PWD/new_experiment_dir}"
shift
TAGS=("$@")
[ ${#TAGS[@]} -eq 0 ] && TAGS=("default")

# Ensure root directory exists
mkdir -p "$ROOT_DIR"

# Create touch helper
TOUCH_SCRIPT="$ROOT_DIR/scripts/bash_touch.sh"
mkdir -p "$(dirname "$TOUCH_SCRIPT")"
cat > "$TOUCH_SCRIPT" << 'EOF'
#!/usr/bin/env bash
for f in "$@"; do
    mkdir -p "$(dirname "$f")"
    [ ! -f "$f" ] && touch "$f"
done
EOF
chmod +x "$TOUCH_SCRIPT"

FILES=(
    "README.md"
    "notebooks/00_data_exploration.ipynb"
    "notebooks/01_model_build.ipynb"
    "notebooks/02_training.ipynb"
    "notebooks/03_inference_quick_explore.ipynb"
    "scripts/py_build_model.py"
    "scripts/build_model.sh"
    "scripts/py_train_model.py"
    "scripts/train_model.sh"
    "scripts/py_inference.py"
    "scripts/inference.sh"
    "scripts/py_utils.py"
)

for tag in "${TAGS[@]}"; do
    TAG_DIR="$ROOT_DIR/$tag"
    mkdir -p "$TAG_DIR"/{notebooks,datasets,models,logs,scripts,visualizations,outputs/csv_logs,outputs/gradcam_images}

    for f in "${FILES[@]}"; do
        base="${f%.*}"
        ext="${f##*.}"
        "$TOUCH_SCRIPT" "$TAG_DIR/${base}_$tag.$ext"
    done
done

echo "Project scaffolding with tags and subdirectories created at $ROOT_DIR"

```

#### Minimal Test Runs

*PowerShell*

```powershell
# Minimal test with two tags
# Ensure working directory is where the directory structure is desired
$RootTest = "$PWD/test_project"
.\structure.ps1 -RootDir $RootTest -Tags "p_01" "p_02"

# Check structure
Get-ChildItem -Recurse -Force $RootTest

```

<h3>Dave's questions</h3>

- Does PowerShell have a `tree` command?
- How likely will it be that we need to use something akin to

```powershell
PS C:\David\my_repos_dwb\fhtw-paper-code-prep> powershell.exe -ExecutionPolicy RemoteSigned
```

*bash*

```bash
chmod +x structure.sh

# Minimal test with two tags
# Once again, ensure working directory is where the directory structure is desired
ROOT_DIR="$PWD/test_project_bash"
./structure.sh "$ROOT_DIR" p_01 p_02

# Check structure
tree -a -F "$ROOT_DIR"

```

#### Expected `tree`-type output

```
(Expected `tree` output, 
   `test_project_tree.txt`, 
 given upon request.
)
```

```plain
test_project/
├─ p_01/
│  ├─ README_p_01.md
│  ├─ notebooks/
│  │  ├─ 00_data_exploration_p_01.ipynb
│  │  ├─ 01_model_build_p_01.ipynb
│  │  ├─ 02_training_p_01.ipynb
│  │  └─ 03_inference_quick_explore_p_01.ipynb
│  ├─ scripts/
│  │  ├─ py_build_model_p_01.py
│  │  ├─ build_model_p_01.cmd
│  │  ├─ py_train_model_p_01.py
│  │  ├─ train_model_p_01.cmd
│  │  ├─ py_inference_p_01.py
│  │  ├─ inference_p_01.cmd
│  │  ├─ py_utils_p_01.py
│  │  └─ py_touch.py
│  ├─ datasets/
│  ├─ models/
│  ├─ logs/
│  ├─ visualizations/
│  └─ outputs/
│     ├─ csv_logs/
│     └─ gradcam_images/
├─ p_02/
│  ├─ README_p_02.md
│  ├─ notebooks/
│  │  ├─ 00_data_exploration_p_02.ipynb
│  │  ├─ 01_model_build_p_02.ipynb
│  │  ├─ 02_training_p_02.ipynb
│  │  └─ 03_inference_quick_explore_p_02.ipynb
│  ├─ scripts/
│  │  ├─ py_build_model_p_02.py
│  │  ├─ build_model_p_02.cmd
│  │  ├─ py_train_model_p_02.py
│  │  ├─ train_model_p_02.cmd
│  │  ├─ py_inference_p_02.py
│  │  ├─ inference_p_02.cmd
│  │  ├─ py_utils_p_02.py
│  │  └─ py_touch.py
│  ├─ datasets/
│  ├─ models/
│  ├─ logs/
│  ├─ visualizations/
│  └─ outputs/
│     ├─ csv_logs/
│     └─ gradcam_images/
```

### Build Model script

Probably just the method inside a Jupyter Notebook cell (*Done-over-perfect* sprint).
Later, perhaps, a changeable version for both Vanilla CNN and ResNet-50++.

```
(Python imports and method, 
   `build_model(<params>)`, 
 as 
   `build_model.py`
 given upon request.
)
```

```python
from tensorflow.keras import layers, Model

def build_model(input_shape=(32,32,3),
                n_classes=10,
                filters=[32,64,64],
                fc_units=64,
                use_conv2=True,
                use_conv3=True,
                multi_label=False):
    """
    Builds a CNN similar to A-0 model with options for ablation and multi-label outputs.

    Args:
        input_shape (tuple): Input image shape, e.g., (32,32,3)
        n_classes (int): Number of output classes
        filters (list of int): Number of filters for conv1, conv2, conv3
        fc_units (int): Units in fully-connected layer
        use_conv2 (bool): Include conv2 block
        use_conv3 (bool): Include conv3 block
        multi_label (bool): True for multi-label classification, False for single-label

    Returns:
        keras.Model: Compiled CNN model (logits if multi_label=False)
    """

    inputs = layers.Input(shape=input_shape)

    # --- Conv1 block ---
    x = layers.Conv2D(filters[0], (3,3), padding='same', activation='relu', name='conv1')(inputs)
    x = layers.MaxPooling2D((2,2))(x)

    # --- Optional Conv2 block ---
    if use_conv2:
        x = layers.Conv2D(filters[1], (3,3), padding='same', activation='relu', name='conv2')(x)
        x = layers.MaxPooling2D((2,2))(x)

    # --- Optional Conv3 block ---
    if use_conv3:
        x = layers.Conv2D(filters[2], (3,3), padding='same', activation='relu', name='conv3')(x)
        x = layers.MaxPooling2D((2,2))(x)

    # --- Fully connected ---
    x = layers.Flatten()(x)
    x = layers.Dense(fc_units, activation='relu')(x)

    # --- Output layer ---
    if multi_label:
        outputs = layers.Dense(n_classes, activation='sigmoid', name='output')(x)
    else:
        outputs = layers.Dense(n_classes, name='output')(x)  # logits; use softmax externally if desired

    model = Model(inputs=inputs, outputs=outputs, name="A0_CNN")

    return model

```

## Other things discussed and scripts/notebooks drafted

- VERY IMPORTANT: GradCAM / guided backprop / SmoothGrad integration
- IMPORTANT logging FLOPs, memory, and an estimate of cost on AWS
- Future-proof the CSVs for these when we get to AWS
- These will all be done, remembering *Done-over-perfect*, on AWS



Benefits:

1.  Parameterized filters and dense units → easy ablation / hyperparameter sweeps
2.	Optional conv blocks → ablation studies without rewriting the model
3.	Multi-label support via sigmoid → supports overlapping classes
4.	Named layers → immediate GradCAM and visualization hooks
5.	Fully compatible with SageMaker Training jobs → just call `build_model()` inside your training script

---

## Meta
- Lab notebook exported to Markdown for context and continuity.  
- Conversation lag resolved by starting a fresh thread with this summary as reference.
